{% set name = 'Triumvirate' %}
{% set version = environ.get('GIT_DESCRIBE_TAG') %}

package:
  name: "{{ name|lower }}"
  version: {{ version|trim('v') }}

source:
  git_url: ../../../

build:
  number: 0
  script: "{{ PYTHON }} -m pip install . -vv"
  script_env:
    - PY_CXX                  # [osx]
    - PY_CXXFLAGS             # [osx]
    - PY_LDFLAGS              # [osx]
    - PY_CXXFLAGS_OMP         # [osx]
    - PY_LDFLAGS_OMP          # [osx]
    - PY_BUILD_PARALLEL="-j"

requirements:
  build:
    - {{ compiler('cxx') }}
    - python                              # [build_platform != target_platform]
    - cross-python_{{ target_platform }}  # [build_platform != target_platform]
    - cython                              # [build_platform != target_platform]
    - numpy                               # [build_platform != target_platform]
  host:
    - python
    - pip >=19.1
    - gsl >=2.7
    - fftw >=3
    - setuptools >=61.0.0
    - setuptools_scm >=6.4.0
    - cython >=0.25
    - extension-helpers
    - numpy
  run:
    - python >=3.8
    - {{ pin_compatible("numpy") }}
    - scipy
    - astropy >=4.2
    - pyyaml >4

test:
  requires:
    - pytest  # [build_platform == target_platform]
  source_files:
    - tests/
  commands:
    - pytest --full-trace --verbose --capture=no --runslow tests/  # [build_platform == target_platform]

about:
  home: https://mikeswang.github.io/Triumvirate
  license: "GNU General Public v3 (GPLv3)"
  license_family: GPL3
  license_file: LICENCE
  summary: "Three-point clustering measurements in large-scale structure analyses."
  doc_url: https://triumvirate.readthedocs.io
  dev_url: https://github.com/MikeSWang/Triumvirate

extra:
  recipe-maintainers:
    - MikeSWang
